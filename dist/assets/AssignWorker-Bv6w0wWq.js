import{r as c,k,u as J,j as e,a as o,b as i,_ as m}from"./index-HHpk9hU4.js";/* empty css                  */import{I as _}from"./index-D6t_bEoc.js";const M=()=>{const[$,b]=c.useState([]),[j,S]=c.useState([]),[n,w]=c.useState(1),[x,y]=c.useState(0),[N,h]=c.useState(!1),[g,u]=c.useState(!1),v=k(s=>s.searchTerm),p=k(s=>s.warranty),P=J(),C=async()=>{try{const s=await o.get(`${i}/jobcard/get-pending?page=${n}&limit=6`);b(s.data.data),y(s.data.totalPages)}catch(s){console.error("Error fetching job cards:",s)}},I=async()=>{var s;try{const a=await o.get(`${i}/worker/available`);S((s=a==null?void 0:a.data)==null?void 0:s.workers)}catch(a){console.error("Error fetching job cards:",a)}},f=async()=>{var s,a;try{console.log(p);const t=await o.get(`${i}/search?page=${n}&limit=6&pending=true&searchTerm=${v}&${p?"warranty=true":""}`);if(t.data.success)console.log("Job cards fetched successfully:",t.data.data),b((s=t==null?void 0:t.data)==null?void 0:s.data),y((a=t==null?void 0:t.data)==null?void 0:a.totalPages);else return console.error("Failed to fetch job cards:",t.data.message),null}catch(t){return console.error("Error fetching job cards:",t.message||t),null}},E=async(s,a)=>{try{if(!s||!a){console.error("Worker ID and Job Card ID are required.");return}const t={workerId:s,jobcardId:a},l=await o.post(`${i}/worker/assign-job`,t);l.status===200?(console.log("Worker assigned successfully:",l.data.message),m.success("Assigned successfully"),h(!1),C()):console.error("Failed to assign worker:",l.data.message)}catch(t){console.error("Error assigning worker:",t.message||t)}},W=async()=>{var s,a,t,l,d;try{const r=await o.put(`${i}/jobcard/return?id=${g}`);if((s=r==null?void 0:r.data)!=null&&s.success)console.log(r.data.message),m.success("Job Returned"),u(!1),f();else return console.error(r.data.message||"Failed to return job card"),m.error("Failed to return job card"),r.data||{success:!1,message:"Unknown error occurred"}}catch(r){return console.error("Error while returning job card:",((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||r.message),{success:!1,message:((d=(l=r.response)==null?void 0:l.data)==null?void 0:d.message)||"Internal server error"}}},D=async()=>{var s,a,t,l,d;try{const r=await o.put(`${i}/jobcard/work-done?id=${g}`);if((s=r==null?void 0:r.data)!=null&&s.success)console.log(r.data.message),m.success("Job Completed"),u(!1),f();else return console.error(r.data.message||"Failed to return job card"),m.error("Failed to complete job card"),r.data||{success:!1,message:"Unknown error occurred"}}catch(r){return console.error("Error while returning job card:",((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||r.message),{success:!1,message:((d=(l=r.response)==null?void 0:l.data)==null?void 0:d.message)||"Internal server error"}}};return c.useEffect(()=>{f(),I(),console.log("re render")},[n,v,p]),e.jsx("div",{className:"min-h-screen w-full px-4 py-6 ",children:e.jsxs("div",{className:"flex flex-col items-start w-full max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Pending Works"}),e.jsx("p",{className:"text-white mb-6",children:"Hi-Tech Engineering Company"}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-[#1e1f20]   rounded-lg shadow-lg w-full max-w-md p-6 relative",children:[e.jsx("button",{onClick:()=>h(!1),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",children:"✖"}),e.jsx("h2",{className:"text-2xl font-bold text-[#3890d8] mb-4",children:"Assign worker"}),e.jsx("div",{className:"flex flex-col",children:j&&j.map((s,a)=>e.jsxs("div",{className:"flex py-2 w-full justify-between px-3 items-center ",children:[e.jsxs("div",{className:"flex gap-5  items-center  ",children:[e.jsx("img",{src:s==null?void 0:s.workerImage,alt:"",className:"w-14 h-14 rounded-full"}),e.jsx("div",{className:"text-white",children:s==null?void 0:s.workerName})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>E(s._id,N),className:"px-4 py-2 bg-[#2690e6] text-white text-sm font-semibold rounded-md transition duration-300 hover:bg-blue-500 active:scale-75 active:bg-blue-600",children:"Assign"})})]},a))})]})}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-[#1e1f20]   rounded-lg shadow-lg w-full max-w-md p-6 relative",children:[e.jsx("button",{onClick:()=>u(!1),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",children:"✖"}),e.jsx("h2",{className:" w-full text-center text-2xl font-bold text-[#3890d8] mb-4",children:"Change status"}),e.jsxs("div",{className:"w-full flex justify-center gap-5 pt-10",children:[e.jsx("button",{className:"bg-red-700 text-white px-3 py-2 rounded-md active:scale-75",onClick:W,children:"Return"}),e.jsx("button",{className:"bg-green-700 text-white px-3 py-2 rounded-md active:scale-75",onClick:D,children:"Completed"})]})]})}),e.jsxs("div",{className:"w-full bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("table",{className:"min-w-full  border border-slate-600",children:[e.jsx("thead",{className:"bg-[#4a4d50] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Customer Name"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Jobcard No."}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Worker"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"",children:$.map(s=>{var a;return e.jsxs("tr",{className:"border-b border-slate-600 bg-[#282a2c] transition duration-300",children:[e.jsx("td",{className:"px-6 py-4 text-white",children:s.customerName}),e.jsx("td",{className:"px-6 py-4 text-white",children:s.phoneNumber}),e.jsx("td",{className:"px-6 py-4 text-white",children:new Date(s.InDate).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-white",children:s.jobCardNumber}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-white text-sm ${s.jobCardStatus==="Completed"?"bg-green-500":s.jobCardStatus==="In Progress"?"bg-yellow-500":"bg-[#d65f63] hover:bg-[#e94560]"}`,children:s.jobCardStatus})}),e.jsx("td",{className:"px-6 py-4 gap-4",children:s.worker?e.jsx("div",{children:e.jsx(_,{src:(a=s==null?void 0:s.worker)==null?void 0:a.workerImage,alt:"workerImage",className:" rounded-full",height:40,width:40})}):e.jsx("button",{className:"px-4 py-2 bg-[#e94560] text-white text-sm font-semibold rounded-md transition duration-300 hover:bg-blue-500 active:scale-75",onClick:()=>h(s._id),children:"Assign"})}),e.jsxs("td",{className:"px-6 py-4 flex gap-4 items-center",children:[e.jsx("button",{className:"px-4 py-2 w-fit h-fit bg-[#3890d8] text-white text-sm font-semibold rounded-md transition duration-300 hover:bg-blue-500 active:scale-75",onClick:()=>P(`/admin/jobcard/${s._id}`),children:"View"}),e.jsx("button",{className:"px-4 py-2 w-20 h-fit bg-[#4a4d50] text-white text-sm font-semibold rounded-md transition duration-300 hover:bg-blue-500 active:scale-75",onClick:()=>u(s._id),children:"Change"})]})]},s._id)})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-[#282a2c]",children:[e.jsx("button",{onClick:()=>w(s=>Math.max(s-1,1)),className:`px-4 py-2 bg-[#3890d8] text-white rounded-md transition duration-300 hover:bg-[#14c8c8] ${n===1?"opacity-50 cursor-not-allowed":""}`,disabled:n===1,children:"Previous"}),e.jsxs("span",{className:"text-white",children:["Page ",n," of ",x]}),e.jsx("button",{onClick:()=>w(s=>Math.min(s+1,x)),className:`px-4 py-2 bg-[#3890d8] text-white rounded-md transition duration-300 hover:bg-[#14c8c8] ${n===x?"opacity-50 cursor-not-allowed":""}`,disabled:n===x,children:"Next"})]})]})]})})};export{M as default};
