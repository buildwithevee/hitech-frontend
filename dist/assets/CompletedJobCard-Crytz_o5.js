import{r as n,k as b,u as $,j as e,S as o,a as w,b as N}from"./index-DQcph4hN.js";/* empty css                  */import{I}from"./index-BcJVJkuS.js";const J=()=>{const[y,j]=n.useState([]),[r,m]=n.useState(1),[i,v]=n.useState(0),u=b(t=>t.searchTerm),d=b(t=>t.warranty),k=$(),S=t=>{o.fire({title:"Enter Invoice Details",html:`
          <input type="text" id="invoiceNumber" class="swal2-input" placeholder="Invoice Number">
        `,background:"#1e1f20",color:"#ffffff",confirmButtonText:"Submit",customClass:{popup:"custom-popup",confirmButton:"custom-confirm-button"},focusConfirm:!1,preConfirm:()=>{var s;const a=(s=document.getElementById("invoiceNumber"))==null?void 0:s.value;return a||o.showValidationMessage("Invoice Number is required!"),{invoiceNumber:a}}}).then(async a=>{var s,h,f,p,g;if(a.isConfirmed)try{const{invoiceNumber:c}=a.value;o.fire({title:"Processing...",text:"Please wait while we complete the job.",allowOutsideClick:!1,didOpen:()=>{o.showLoading()}});const l=await w.put(`${N}/jobcard/bill-done?id=${t}&invoiceNumber=${c}`);(s=l==null?void 0:l.data)!=null&&s.success?(console.log(l.data.message),o.fire({title:"Success!",text:"Job Completed Successfully.",icon:"success",background:"#1e1f20",color:"#ffffff"}),x()):(console.error(l.data.message||"Failed to complete job card"),o.fire({title:"Error!",text:l.data.message||"Failed to complete job card.",icon:"error",background:"#1e1f20",color:"#ffffff"}))}catch(c){console.error("Error while completing job card:",((f=(h=c.response)==null?void 0:h.data)==null?void 0:f.message)||c.message),o.fire({title:"Error!",text:((g=(p=c.response)==null?void 0:p.data)==null?void 0:g.message)||"Internal server error",icon:"error",background:"#1e1f20",color:"#ffffff"})}})},x=async()=>{var t,a;try{console.log(d);const s=await w.get(`${N}/search?page=${r}&limit=6&completed=true&searchTerm=${u}&${d?"warranty=true":""}`);if(s.data.success)console.log("Job cards fetched successfully:",s.data.data),j((t=s==null?void 0:s.data)==null?void 0:t.data),v((a=s==null?void 0:s.data)==null?void 0:a.totalPages);else return console.error("Failed to fetch job cards:",s.data.message),null}catch(s){return console.error("Error fetching job cards:",s.message||s),null}};return n.useEffect(()=>{x(),console.log("re render")},[r,u,d]),e.jsx("div",{className:"min-h-screen w-full px-4 py-6 ",children:e.jsxs("div",{className:"flex flex-col items-start w-full max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Completed Works"}),e.jsx("p",{className:"text-white mb-6",children:"Hi-Tech Engineering Company"}),e.jsxs("div",{className:"w-full bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("table",{className:"min-w-full  border border-slate-600",children:[e.jsx("thead",{className:"bg-[#4a4d50] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Customer Name"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Make"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Worker"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Action"})]})}),e.jsx("tbody",{className:"",children:y.map(t=>{var a;return e.jsxs("tr",{className:"border-b border-slate-600 bg-[#282a2c] transition duration-300",children:[e.jsx("td",{className:"px-6 py-4 text-white",children:t.customerName}),e.jsx("td",{className:"px-6 py-4 text-white",children:t.phoneNumber}),e.jsx("td",{className:"px-6 py-4 text-white",children:new Date(t.InDate).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-white",children:t.Make}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-white text-sm ${t.jobCardStatus==="Completed"?"bg-green-500":t.jobCardStatus==="In Progress"?"bg-yellow-500":"bg-[#d65f63] hover:bg-[#e94560]"}`,children:t.jobCardStatus})}),e.jsx("td",{className:"px-6 py-4 gap-4",children:t.worker&&e.jsx("div",{children:e.jsx(I,{src:(a=t==null?void 0:t.worker)==null?void 0:a.workerImage,alt:"workerImage",className:" rounded-full",height:40,width:40})})}),e.jsxs("td",{className:"px-6 py-4 flex gap-4 items-center",children:[e.jsx("button",{className:"px-4 py-2 w-fit h-fit bg-[#3890d8] text-white text-sm font-semibold rounded-md transition duration-300 hover:bg-blue-500 active:scale-75",onClick:()=>k(`/admin/jobcard/${t._id}`),children:"View"}),e.jsx("button",{className:"px-4 py-2 w-20 h-fit bg-[#4a4d50] text-white text-sm font-semibold rounded-md transition duration-300 hover:bg-blue-500 active:scale-75",onClick:()=>S(t._id),children:"Bill"})]})]},t._id)})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-[#282a2c]",children:[e.jsx("button",{onClick:()=>m(t=>Math.max(t-1,1)),className:`px-4 py-2 bg-[#3890d8] text-white rounded-md transition duration-300 hover:bg-[#14c8c8] ${r===1?"opacity-50 cursor-not-allowed":""}`,disabled:r===1,children:"Previous"}),e.jsxs("span",{className:"text-white",children:["Page ",r," of ",i]}),e.jsx("button",{onClick:()=>m(t=>Math.min(t+1,i)),className:`px-4 py-2 bg-[#3890d8] text-white rounded-md transition duration-300 hover:bg-[#14c8c8] ${r===i?"opacity-50 cursor-not-allowed":""}`,disabled:r===i,children:"Next"})]})]})]})})};export{J as default};
